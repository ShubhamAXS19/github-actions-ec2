name: Deploy to EC2

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Configure SSH
      run: |
        mkdir -p ~/.ssh/
        echo "${{ secrets.EC2_SSH_KEY }}" > ~/.ssh/private_key.pem
        chmod 600 ~/.ssh/private_key.pem
        # Replace XX.XX.XX.XX with your EC2 IP
        ssh-keyscan -H 65.0.31.64 >> ~/.ssh/known_hosts
    
    - name: Deploy to EC2
      run: |
        # Replace XX.XX.XX.XX with your EC2 IP
        ssh -i ~/.ssh/private_key.pem ubuntu@65.0.31.64 '
          mkdir -p ~/app
          cd ~/app
          echo "Deployment successful! $(date)" > deployment_log.txt
          ls -la
          echo "Deployment completed successfully!"
        '